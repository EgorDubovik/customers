!function(e){e.fn.edEvents=function(a){var n,i={startTime:"00:00",endTime:"23:00",dayOrWeek:"week",events:[],isAmPm:!0,eventBackground:"#3f87ed",timeIndicator:!0,isDraggable:!0,onEndDrag:null,onEventClick:null,isModayFirst:!0,onDayRender:null,selectedDay:moment().format()},d=e.extend({},i,a);d.isModayFirst&&moment.updateLocale("en",{week:{dow:1}});var s=moment(d.selectedDay),r=moment(d.startTime,"HH:mm"),o=moment(d.endTime,"HH:mm"),m=moment.duration(o.diff(r)).asMinutes(),l=e(this),c=e("<div>").addClass("main-container").addClass("disable-select"),p=e("<div>").addClass("nav-bar-conteiner"),f=e("<div>").addClass("header-wrapper"),u=0,v=1500/m,h=0,y=0,C=0,T=0,$=!0;this.init=function(){return k(),this};var k=function(){A.isAvelable(),w.init(),g.init(),H()},g={selectedAppointments:[],init:function(){$&&(this.cleanAppointments(),this.fetchAppointments())},fetchAppointments:function(){this.selectedAppointments=this.getAppointments(),this.selectedAppointments=this.selectedAppointments.sort((e,a)=>moment(e.startTime).diff(moment(a.startTime))),this.groupAppointments(this.selectedAppointments,[]).forEach(e=>{for(var a=0;a<e.appointments.length;a++){var n=this.selectedAppointments.indexOf(e.appointments[a]),i=this.createEvent(e.appointments[a],a,e.appointments.length,n);if("week"==d.dayOrWeek)var s=e.appointments[a].startTime.weekday();else if("days"==d.dayOrWeek)var s=0;l.find(".day-events-conteiner").eq(s).append(i)}})},getAppointments:function(){var e=d.events;if("week"==d.dayOrWeek)var a=s.clone().weekday(0).set({hour:"00",minute:"00"}),n=s.clone().weekday(6).set({hour:23,minute:59});else if("days"==d.dayOrWeek)var a=s.clone().set({hour:"00",minute:"00"}),n=s.clone().set({hour:23,minute:59});return e.filter(e=>(e.startTime=moment(e.startTime),e.endTime=moment(e.endTime),e.startTime.isBetween(a,n)||e.endTime.isBetween(a,n)||e.startTime.isBefore(a)&&e.endTime.isAfter(n)))},createEvent:function(a,n,i,s){var r=e("<div>").addClass("event-conteiner");a.addClass&&r.addClass(a.addClass);var o=e("<div>").addClass("event-conteiner-inner").addClass("disable-select").attr("aria-hidden",!0);if(a.customTemplate)o.html(a.customTemplate);else{var m=e("<div>").addClass("event-title").addClass("disable-select").html('<a href="'+(a.href??"#")+'">'+(a.title??"")+"</a>"),l=e("<div>").addClass("event-title").addClass("event-time").text(a.startTime.format(d.isAmPm?"hh:mm A":"HH:mm")+" - "+a.endTime.format(d.isAmPm?"hh:mm A":"HH:mm"));o.append(m).append(l)}var c=a.background??d.eventBackground,p=e("<div>").addClass("event-conteiner-background").css("background",c),f=this.calculateEventTop(a),u=100/i;return r.attr("data-index",s).attr("data-height",f.height).attr("data-top",f.top).css("height",f.height+"%").css("top",f.top+"%").css("width",u+"%").css("left",u*n+"%").css("right","auto"),r.append(p).append(o),r},calculateEventTop:function(e){var a=A.getTopProcentByTime(e.startTime);return{top:a,height:A.getTopProcentByTime(e.endTime)-a}},groupAppointments:function(e,a){return e.forEach(e=>{let n=a.find(a=>e.startTime.isBetween(a.start,a.end,null,"[)")||e.endTime.isBetween(a.start,a.end,null,"(]"));n?n.appointments.push(e):a.push({start:e.startTime,end:e.endTime,appointments:[e]})}),a},cleanAppointments:function(){c.find(".day-events-conteiner").each(function(){e(this).empty()})}},w={init:function(){this.clearCalendar(),this.initMainConteiners(),this.createNavBar(),this.createCalendarView(),A.initVariables()},clearCalendar:function(){c=e("<div>").addClass("main-container").addClass("disable-select"),p=e("<div>").addClass("nav-bar-conteiner"),f=e("<div>").addClass("header-wrapper"),l.empty()},initMainConteiners:function(){c.append(p),c.append(f),l.append(c)},createNavBar:function(){var a=e("<div>").attr("type","button").addClass("next-page").text(">"),n=e("<div>").attr("type","button").addClass("prev-page").text("<"),i=e("<div>").attr("type","button").addClass("today-page").text("Today"),d=e("<div>").addClass("nav-bar-month").append(e("<span>").addClass("text-conteiner").text(s.format("MMMM YYYY"))),r=e("<div>").addClass("nav-bar-inner").append(d).append(n).append(i).append(a);p.html(r)},createCalendarView:function(){this.createDaysHeader();for(var a=e("<div>").addClass("schedule-wrapper"),n=e("<div>").addClass("time-slots"),i=moment(d.startTime,"HH:mm"),r=moment(d.endTime,"HH:mm"),o=i.clone(),m='<div class="day-events-conteiner"></div>';o.isSameOrBefore(r);){var p=e("<div>").addClass("time-slot-text").text(o.format(d.isAmPm?"hh A":"HH:mm")),f=e("<div>").addClass("time-slot");f.append(p),n.append(f),o.isSame(r)||(m+='<div class="day-colum-inner-item"></div>'),o.add(60,"minutes")}d.timeIndicator&&this.createIndicatorNow(n);var u=e("<div>").addClass("time-slots-inner").append(n),v=e("<div>").addClass("time-slots-inner-conteainer").append(u);a.append(v);var h=e("<div>").addClass("schedule-conteiner-inner");if("week"==d.dayOrWeek)for(var y=0;y<7;y++){var C=e("<div>").addClass("day-colum-inner");C.append(m);var T=e("<div>").addClass("day-colum").append(C);s.clone().weekday(y).startOf("day").isSame(moment().startOf("day"))&&T.addClass("today"),null!=d.onDayRender&&d.onDayRender(s.clone().weekday(y),T),h.append(T)}else if("days"==d.dayOrWeek){var C=e("<div>").addClass("day-colum-inner");C.append(m);var T=e("<div>").addClass("day-colum").append(C);h.append(T)}var $=e("<div>").addClass("schedule-container").append(h);a.append($),c.append(a),l.append(c)},createDaysHeader:function(){f.empty(),f.append(e("<div>").addClass("header-first-item"));for(var a=e("<div>").addClass("header-container"),n=e("<div>").addClass("header-items"),i=0;i<7;i++){var r="week"==d.dayOrWeek?s.clone().weekday(i).format("ddd"):s.clone().weekday(i).format("dd")+"<br>",o=s.clone().weekday(i).format("DD"),m=e("<div>").addClass("header-item");"week"==d.dayOrWeek?s.clone().weekday(i).startOf("day").isSame(moment().startOf("day"))&&m.addClass("today"):"days"==d.dayOrWeek&&s.clone().weekday(i).startOf("day").isSame(s.clone().startOf("day"))&&m.addClass("today"),m.append(e("<div>").addClass("header-item-text").html(r+" "+o)),n.append(m)}a.append(n),f.append(a)},createIndicatorNow:function(e){var a=moment();if(a.isBetween(moment(d.startTime,"hh:mm"),moment(d.endTime,"hh:mm"))){var n=A.getTopProcentByTime(moment()),i=a.format(d.isAmPm?"hh:mm A":"HH:mm");e.append('<div aria-hidden="true" class="now-line" style="top: '+n+'%;"><div class="time-now-ind">'+i+"</div></div>")}}},H=function(){var a=!1,i=null,o=!1;function m(e){if(a)return}function c(s){let r=s.target.closest("a");if(r){window.location=r.href;return}i=e(this),d.isDraggable&&(a=!0,o=!1,i.css("width","100%").css("left","0%").css("z-index",9999),n=i.parent().parent().parent().index(),T=i.height(),u=s.pageY-i.offset().top,C=l.find(".day-colum-inner").offset().top)}function p(s){if(a){var m=s.pageY-C-u,c=e(this).parent().index();if(c!=n&&(o=!0,i.remove(),l.find(".day-colum-inner").eq(c).find(".day-events-conteiner").append(i),n=c),m>=0&&T+m<=y&&(t=Math.round(m/h),m>=t*h-2&&m<=t*h+2)){o=!0;var p=100*(m=t*h)/y;i.css("top",p+"%"),i.attr("data-top",p);var f=A.procentToMinutes(p),v=A.procentToMinutes(i.attr("data-height")),$=r.clone().add(f,"minutes"),k=r.clone().add(f+v,"minutes");i.find(".event-time").text($.format(d.isAmPm?"hh:mm A":"HH:mm")+" - "+k.format(d.isAmPm?"hh:mm A":"HH:mm"))}}}function f(e){if(a=!1,i){var s=g.selectedAppointments[i.attr("data-index")];if(o){let m=A.procentToMinutes(i.attr("data-top")),l=A.procentToMinutes(i.attr("data-height")),c=r.clone().add(m,"minutes").format("HH:mm"),p=r.clone().add(m+l,"minutes").format("HH:mm");s.startTime="week"==d.dayOrWeek?moment(s.startTime.weekday(n).format("YYYY-MM-DD")+" "+c):moment(s.startTime.format("YYYY-MM-DD")+" "+c),s.endTime="week"==d.dayOrWeek?moment(s.startTime.weekday(n).format("YYYY-MM-DD")+" "+p):moment(s.startTime.format("YYYY-MM-DD")+" "+p),g.init(),null!=d.onEndDrag&&null!=s&&d.onEndDrag(A.reformatEvent(s))}else if(null!=d.onEventClick&&null!=s){let f=A.reformatEvent(s);d.onEventClick(f)}g.init()}o=!1}function v(){s.subtract(1,d.dayOrWeek),H()}function $(){s.subtract(-1,d.dayOrWeek),H()}function k(){s=moment(),H()}function H(){w.createNavBar(),w.createDaysHeader(),g.init()}l.off(),l.on("click",".prev-page",v),l.on("click",".today-page",k),l.on("click",".next-page",$),l.on("mousedown",".event-conteiner",c),l.on("mousemove",".day-colum-inner",p),l.on("mousedown",".day-colum-inner",m),l.on("mouseup",".event-conteiner",f)},A={getTopProcentByTime:function(e){var a,n=moment(e.format("HH:mm"),"HH:mm");return moment.duration(n.diff(r)).asMinutes()/m*100},procentToMinutes:function(e){return Math.round(m*e/100)},initVariables:function(){h=v*(y=l.find(".day-colum-inner").height())/100},isAvelable:function(){let e=location.href;-1==e.indexOf("customers")&&-1==e.indexOf("appointment")&&($=!1)},reformatEvent:function(e){return e.startTime=e.startTime.format("YYYY-MM-DD HH:mm"),e.endTime=e.endTime.format("YYYY-MM-DD HH:mm"),e}};return this.changeView=function(e){d.dayOrWeek=e,k()},this.addEvent=function(e){d.events.push(e),k()},this.reRenderCalendar=function(){k()},this.setSelectedDay=function(e){d.selectedDay=moment(e),s=d.selectedDay,k()},this.getEvents=function(){return d.events},this.cleanEvents=function(){d.events=[],k()},this.init()}}(jQuery);